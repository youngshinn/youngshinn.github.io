---
layout: single
title:  "AWS VPC 네트워크 기초 및 보안 설정"
categories: AWS
tag: [vpc, Aws, Network]
search: true
---

## **AWS Virtual Private Cloud(VPC)란?**
**AWS VPC(Virtual Private Cloud)**는 AWS에서 제공하는 가상 네트워크 서비스입니다.
사용자는 VPC를 통해 AWS 리소스를 격리된 네트워크 환경에서 운영할 수 있습니다.

VPC를 활용하면, IP 주소 범위 설정, 서브넷 생성, 라우팅, 네트워크 보안 등의 작업을 수행할 수 있습니다.

## **1. VPC의 주요 구성**

### **1.1 VPC와 서브넷**
- **VPC(가상 네트워크)**: AWS 내부에서 독립적인 네트워크 환경을 생성.
- **서브넷(Subnet)**: VPC 내부를 작은 네트워크 단위로 분할.
- 각 서브넷은 CIDR(클래스 없는 도메인 라우팅) 블록을 사용하여 IP 주소 범위를 지정.
- 서브넷은 AZ(가용 영역) 단위로 구성됨.

**CIDR 예약 IP 주소**
각 서브넷은 5개의 IP 주소가 AWS에서 예약되어 사용 불가능합니다.

| 예약된 IP   | 용도                     |
|------------|--------------------------|
| 10.10.0.0  | 네트워크 주소            |
| 10.10.0.1  | AWS VPC 라우터           |
| 10.10.0.2  | AWS DNS 서버             |
| 10.10.0.3  | 예비 IP (향후 사용 가능) |
| 10.10.0.255| 브로드캐스트 주소        |

### **1.2 라우팅 테이블(Routing Table)**
VPC 내에서 **트래픽이 어디로 가야 하는지 결정하는 규칙**을 설정하는 테이블입니다.

**라우팅의 기본 원칙**
- 모든 서브넷은 하나의 라우팅 테이블과 연결됨.
- LPM(Longest Prefix Match, 최장 접두사 일치) 알고리즘 사용.
   예시: 10.0.1.5 → 10.0.0.0/16 과 10.0.1.0/24 두 개의 경로와 일치하는 경우, **더 좁은 범위(10.0.1.0/24)가 우선 적용됨**.
- 인터넷으로 나가는 트래픽은 0.0.0.0/0 경로를 통해 IGW(인터넷 게이트웨이)로 연결됨.

### **1.3 퍼블릭 서브넷과 프라이빗 서브넷**
VPC 서브넷은 크게 퍼블릭 서브넷과 프라이빗 서브넷으로 나뉩니다.

| 서브넷 유형     | 특징                                           |
|--------------|----------------------------------------------|
| 퍼블릭 서브넷  | 인터넷 게이트웨이(IGW)를 통해 외부와 연결됨.    |
| 프라이빗 서브넷 | 외부에서 직접 접근 불가능, NAT Gateway 필요.  |

*사용 예시*
- 퍼블릭 서브넷: 웹 서버, 로드 밸런서 배치.
- 프라이빗 서브넷: 데이터베이스, 내부 API 서버 배치.

### **1.4 NAT(Network Address Translation)**
프라이빗 서브넷이 인터넷과 통신할 수 있도록 도와주는 서비스입니다.

**NAT 필요한 이유**
- 내부 네트워크는 프라이빗 IP를 사용하므로 외부 인터넷과 직접 통신할 수 없음.
- NAT를 이용해 퍼블릭 IP로 변환하여 외부 서비스와 통신 가능.
- 보안 강화 효과 → 내부 IP는 노출되지 않음.

**NAT의 두 가지 방식**
| NAT 방식            | 설명                                             | AWS에서의 동작 방식                         |
|--------------------|---------------------------------|----------------------------------|
| **Static NAT**    | 내부 IP 하나를 특정 퍼블릭 IP로 1:1 매핑.       | 인터넷 게이트웨이(IGW)는 Static NAT 방식으로 동작. |
| **PAT (Port Address Translation)** | 여러 내부 IP가 하나의 퍼블릭 IP를 공유. | NAT Gateway는 PAT 방식을 사용하여 동작. |

### **1.5 Elastic IP (EIP)**
AWS에서 제공하는 고정 퍼블릭 IP 주소입니다.

- 특정 리소스(EC2, NAT Gateway 등)에 할당 가능.
- 유휴 상태(사용되지 않을 때)에는 비용이 발생함.
- EC2 인스턴스가 재시작될 때도 **변하지 않는 IP 유지 가능.**

*사용 예시*
- NAT Gateway에 Elastic IP를 할당하면, 외부와 통신할 때 고정된 IP 사용 가능.


## **2. 네트워크 보안 설정**
AWS에서는 **Security Group**과 **NACL(Network ACL)**을 사용하여 VPC의 보안을 관리합니다.

### **2.1 Security Group**
AWS에서 **EC2 인스턴스 수준**에서 동작하는 방화벽입니다.

- Stateful(상태 기반 보안)
- 인바운드 규칙이 허용되면, 자동으로 응답 트래픽도 허용됨.
- 리소스(EC2, RDS 등)에 직접 연결됨.
- 특정 IP 또는 다른 Security Group과의 통신을 허용 가능.

*사용 예시*
- SSH(22포트) → 특정 IP만 허용 (203.0.113.1/32)
- 웹 서버(80, 443) → 모든 IP 허용 (0.0.0.0/0)

### **2.2 Network ACL(NACL)**
VPC의 **서브넷 수준**에서 동작하는 방화벽입니다.

- **Stateless(비상태 기반 보안)** → 인바운드와 아웃바운드를 개별적으로 허용해야 함.
- 서브넷 전체에 대한 트래픽을 필터링.
- Security Group보다 우선순위가 높음.

*사용 예시*
- 공격 차단: 특정 IP 대역의 접근 차단.
- 보안 레벨 추가: Security Group과 조합하여 세밀한 보안 정책 적용.